<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Netball Rotations</title>

<style>
body{font-family:-apple-system,system-ui;margin:0;background:#f5f5f5}
header{background:#111;color:#fff;padding:12px}
main{padding:12px;display:grid;gap:12px}
.card{background:#fff;border:1px solid #ddd;border-radius:14px;padding:12px}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.grow{flex:1}
.seg button{border:1px solid #ddd;border-radius:999px;padding:8px 12px;font-weight:700}
.seg .active{background:#111;color:#fff}
button.primary{background:#111;color:#fff;border-radius:10px;padding:8px 12px;font-weight:800}
button.ghost{border:1px solid #ddd;border-radius:10px;padding:8px 12px;font-weight:700}
.muted{color:#666;font-size:13px}
.pos{width:48px;text-align:center;font-weight:900}
select,input{padding:8px;border-radius:10px;border:1px solid #ddd}
.score{font-size:32px;font-weight:900;line-height:1}
.right{text-align:right}
</style>
</head>

<body>
<header><b>Netball Rotations</b></header>

<main>

<!-- SEASON -->
<section class="card">
  <div class="row">
    <input id="teamName" placeholder="Your team" class="grow">
    <button class="ghost" id="prevGame">◀</button>
    <b id="roundLabel">Round 1</b>
    <button class="ghost" id="nextGame">▶</button>
    <button class="primary" id="addGame">+ Add game</button>
  </div>

  <div class="row">
    <input id="roundName" placeholder="Round name" class="grow">
    <input id="roundDate" type="date">
    <input id="opponent" placeholder="Opponent" class="grow">
  </div>

  <div class="row seg" id="roundButtons"></div>
</section>

<!-- QUARTER / SCORE -->
<section class="card">
  <div class="row seg" id="qtrButtons"></div>
  <div class="muted">Editing <b id="editQ">Q1</b> | Live <b id="liveQ">Q1</b></div>

  <div class="row">
    <button class="ghost" id="setLive">Set live = editing</button>
    <button class="primary" id="finishQ">Qtr finished → Next</button>
  </div>

  <div class="row">
    <span class="score" id="timer">10:00</span>
    <select id="minutes">
      <option>5</option><option>6</option><option>7</option><option>8</option>
      <option selected>10</option><option>12</option><option>15</option>
    </select>
    <button class="primary" id="startTimer">Start</button>
    <button class="ghost" id="resetTimer">Reset</button>
  </div>

  <!-- LIVE TOTAL SCORE -->
  <div class="row" style="align-items:flex-end;">
    <div>
      <div class="score" id="homeScore">0</div>
      <div class="muted" id="homeTeamLabel">Home</div>
    </div>

    <button class="primary" id="homePlus">+Home</button>
    <button class="primary" id="gsPlus">+GS (<span id="gsName">—</span>)</button>
    <button class="primary" id="gaPlus">+GA (<span id="gaName">—</span>)</button>
    <button class="ghost" id="homeMinus">−</button>

    <div class="grow"></div>

    <div class="right">
      <div class="score" id="awayScore">0</div>
      <div class="muted" id="awayTeamLabel">Opponent</div>
    </div>

    <button class="primary" id="awayPlus">+Away</button>
    <button class="ghost" id="awayMinus">−</button>
    <button class="ghost" id="undo">Undo</button>
  </div>
</section>

<!-- POSITIONS -->
<section class="card">
  <b>Positions</b>
  <div id="positions"></div>
</section>

</main>

<script>
const POS=["GS","GA","WA","C","WD","GD","GK"];
let timerInt=null;

function newGame(r){
  return {round:r,roundName:"",date:"",opp:"",
    editQ:0,liveQ:0,mins:10,remain:600,run:false,last:0,
    qs:[...Array(4)].map(()=>({a:{},h:0,o:0}))}
}

let S=JSON.parse(localStorage.netball||"null")||{
  team:"",players:[...Array(10)].map((_,i)=>({id:i,n:"Player "+(i+1)})),
  games:[newGame(1)],cur:0
};

function g(){return S.games[S.cur]}
function save(){localStorage.netball=JSON.stringify(S)}
function fmt(s){return String(Math.floor(s/60)).padStart(2,"0")+":"+String(s%60).padStart(2,"0")}
function totals(G){return{
  h:G.qs.reduce((s,q)=>s+q.h,0),
  o:G.qs.reduce((s,q)=>s+q.o,0)
}}

function render(){
  const G=g();
  teamName.value=S.team;
  roundLabel.textContent="Round "+G.round;
  roundName.value=G.roundName;
  roundDate.value=G.date;
  opponent.value=G.opp;

  editQ.textContent="Q"+(G.editQ+1);
  liveQ.textContent="Q"+(G.liveQ+1);
  timer.textContent=fmt(G.remain);

  const t=totals(G);
  homeScore.textContent=t.h;
  awayScore.textContent=t.o;
  homeTeamLabel.textContent=S.team||"Home";
  awayTeamLabel.textContent=G.opp||"Opponent";

  qtrButtons.innerHTML="";
  for(let i=0;i<4;i++){
    let b=document.createElement("button");
    b.textContent="Q"+(i+1);
    if(i===G.editQ)b.className="active";
    b.onclick=()=>{G.editQ=i;G.run=false;G.remain=G.mins*60;render()}
    qtrButtons.appendChild(b);
  }

  roundButtons.innerHTML="";
  S.games.forEach((x,i)=>{
    let b=document.createElement("button");
    b.textContent="R"+x.round;
    if(i===S.cur)b.className="active";
    b.onclick=()=>{S.cur=i;render()}
    roundButtons.appendChild(b);
  });

  positions.innerHTML="";
  POS.forEach(p=>{
    let r=document.createElement("div");r.className="row";
    let s=document.createElement("select");
    s.innerHTML="<option></option>"+S.players.map(x=>`<option value="${x.id}">${x.n}</option>`).join("");
    s.value=G.qs[G.editQ].a[p]??"";
    s.onchange=()=>{G.qs[G.editQ].a[p]=s.value?Number(s.value):null;render()}
    r.innerHTML=`<div class="pos">${p}</div>`;
    r.appendChild(s);positions.appendChild(r)
  });

  gsName.textContent=G.qs[G.liveQ].a.GS!=null?S.players[G.qs[G.liveQ].a.GS].n:"—";
  gaName.textContent=G.qs[G.liveQ].a.GA!=null?S.players[G.qs[G.liveQ].a.GA].n:"—";

  save();
}

/* TIMER */
function tick(){
  const G=g();
  if(!G.run)return;
  let d=Math.floor((Date.now()-G.last)/1000);
  if(d>0){
    G.remain=Math.max(0,G.remain-d);
    G.last=Date.now();
    if(G.remain===0){G.run=false;alert("Time!")}
    render();
  }
}
startTimer.onclick=()=>{const G=g();G.run=!G.run;G.last=Date.now();timerInt||(timerInt=setInterval(tick,250));render()}
resetTimer.onclick=()=>{const G=g();G.run=false;G.remain=G.mins*60;render()}
minutes.onchange=e=>{const G=g();G.mins=+e.target.value;G.run=false;G.remain=G.mins*60;render()}

/* QUARTER */
finishQ.onclick=()=>{const G=g();if(G.liveQ>=3)return alert("Already Q4");G.run=false;G.remain=G.mins*60;G.liveQ++;G.editQ=G.liveQ;render()}
setLive.onclick=()=>{g().liveQ=g().editQ;render()}

/* SCORING (LIVE) */
homePlus.onclick=()=>{g().qs[g().liveQ].h++;render()}
awayPlus.onclick=()=>{g().qs[g().liveQ].o++;render()}
homeMinus.onclick=()=>{const Q=g().qs[g().liveQ];Q.h=Math.max(0,Q.h-1);render()}
awayMinus.onclick=()=>{const Q=g().qs[g().liveQ];Q.o=Math.max(0,Q.o-1);render()}
gsPlus.onclick=()=>{const G=g();const id=G.qs[G.liveQ].a.GS;if(id==null)return alert("Assign GS");G.qs[G.liveQ].h++;render()}
gaPlus.onclick=()=>{const G=g();const id=G.qs[G.liveQ].a.GA;if(id==null)return alert("Assign GA");G.qs[G.liveQ].h++;render()}
undo.onclick=()=>alert("Undo left simple")

/* GAMES */
addGame.onclick=()=>{S.games.push(newGame(S.games.length+1));S.cur=S.games.length-1;render()}
prevGame.onclick=()=>{if(S.cur>0){S.cur--;render()}}
nextGame.onclick=()=>{if(S.cur<S.games.length-1){S.cur++;render()}}

/* INPUTS */
teamName.oninput=e=>{S.team=e.target.value;render()}
roundName.oninput=e=>{g().roundName=e.target.value;save()}
roundDate.oninput=e=>{g().date=e.target.value;render()}
opponent.oninput=e=>{g().opp=e.target.value;render()}

render();
</script>
</body>
</html>