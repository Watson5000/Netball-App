<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#111111" />
  <link rel="manifest" href="manifest.json">
  <title>Netball Rotations</title>

  <style>
    :root { --pad:12px; --r:14px; --b:1px solid #ddd; }
    body { margin:0; font-family:-apple-system, system-ui, Arial; background:#f6f6f6; }
    header { padding:var(--pad); background:#111; color:#fff; }
    header h1 { margin:0; font-size:18px; }
    header .sub { font-size:13px; opacity:.85; margin-top:4px; display:flex; gap:10px; flex-wrap:wrap; }
    main { padding:var(--pad); display:grid; gap:var(--pad); }
    .card { background:#fff; border:var(--b); border-radius:var(--r); padding:var(--pad); }
    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .grow { flex:1; }
    .seg button { border:var(--b); background:#fff; padding:10px 12px; border-radius:999px; font-weight:800; }
    .seg button.active { background:#111; color:#fff; }
    button.primary { background:#111; color:#fff; border:1px solid #111; border-radius:12px; padding:12px 14px; font-weight:900; }
    button.ghost { background:#fff; border:var(--b); border-radius:12px; padding:12px 14px; font-weight:900; }
    button.small { padding:8px 10px; border-radius:10px; }
    select, input, textarea { border:var(--b); border-radius:12px; padding:10px 12px; font-size:16px; width:100%; }
    textarea { min-height:70px; }
    .grid7 { display:grid; gap:10px; }
    @media (min-width:780px){ .grid7{grid-template-columns:1fr 1fr;} }
    .posRow { display:flex; gap:10px; align-items:center; }
    .posTag { width:54px; text-align:center; padding:8px 0; border-radius:10px; background:#f0f0f0; font-weight:900; }
    .score { font-size:26px; font-weight:950; }
    .muted { color:#666; font-size:13px; }
    .pill { display:flex; justify-content:space-between; padding:10px 12px; border:var(--b); border-radius:12px; }
    table { width:100%; border-collapse:collapse; }
    th, td { border:var(--b); padding:8px; }
    th { background:#fafafa; }
    .kbd { font-family:monospace; background:#eee; padding:2px 6px; border-radius:6px; }
  </style>
</head>

<body>
<header>
  <h1>Netball Rotations</h1>
  <div class="sub">
    <span>10 players • 4 quarters • GS/GA credit goals</span>
    <span id="saveState"></span>
  </div>
</header>

<main>

<!-- SETUP -->
<section class="card">
  <div class="row">
    <input id="teamName" placeholder="Your Team">
    <input id="opponent" placeholder="Opponent">
    <button class="ghost small" id="newGameBtn">New Game</button>
  </div>

  <div style="margin-top:10px" id="players"></div>
</section>

<!-- QUARTER / SCORE -->
<section class="card">
  <div class="row">
    <div class="seg" id="quarters"></div>
  </div>

  <div class="row" style="margin-top:10px">
    <div>
      <div class="muted">Home</div>
      <div class="score" id="homeScore">0</div>
    </div>
    <div style="flex:1"></div>
    <div style="text-align:right">
      <div class="muted">Away</div>
      <div class="score" id="awayScore">0</div>
    </div>
  </div>

  <div class="row" style="margin-top:10px">
    <button class="primary" onclick="scoreTeam('home',1)">Home +1</button>
    <button class="ghost" onclick="scoreTeam('home',-1)">−</button>
    <div class="grow"></div>
    <button class="primary" onclick="scoreTeam('away',1)">Away +1</button>
    <button class="ghost" onclick="scoreTeam('away',-1)">−</button>
    <button class="ghost" onclick="undo()">Undo</button>
  </div>
</section>

<!-- POSITIONS -->
<section class="card">
  <h3>Positions</h3>
  <div class="grid7" id="positions"></div>
</section>

<!-- STATS -->
<section class="card">
  <h3>Stats</h3>
  <div id="stats"></div>
</section>

<!-- NOTES -->
<section class="card">
  <h3>Notes</h3>
  <textarea id="notes"></textarea>
</section>

</main>

<script>
const POS=["GS","GA","WA","C","WD","GD","GK"];
let S=JSON.parse(localStorage.netball||"null")||{
  q:0, team:"", opp:"", notes:"",
  players:[...Array(10)].map((_,i)=>({id:crypto.randomUUID(),name:"Player "+(i+1),g:[0,0,0,0]})),
  qs:[...Array(4)].map(()=>({a:{},h:0,o:0,e:[]}))
};

function save(){localStorage.netball=JSON.stringify(S);}
function scoreTeam(w,d){let q=S.q; w=="home"?S.qs[q].h=Math.max(0,S.qs[q].h+d):S.qs[q].o=Math.max(0,S.qs[q].o+d); save(); draw();}
function scorePos(p){let q=S.q,id=S.qs[q].a[p]; if(!id)return alert("Assign "+p); let pl=S.players.find(x=>x.id==id); S.qs[q].h++; pl.g[q]++; S.qs[q].e.push({id}); save(); draw();}
function undo(){let q=S.q,e=S.qs[q].e.pop(); if(!e)return; let p=S.players.find(x=>x.id==e.id); S.qs[q].h--; p.g[q]--; save(); draw();}
function draw(){
  document.getElementById("homeScore").innerText=S.qs[S.q].h;
  document.getElementById("awayScore").innerText=S.qs[S.q].o;
  let pos=document.getElementById("positions"); pos.innerHTML="";
  POS.forEach(p=>{
    let d=document.createElement("div"); d.className="posRow";
    let s=document.createElement("select"); s.innerHTML="<option></option>"+S.players.map(x=>`<option value='${x.id}'>${x.name}</option>`).join("");
    s.value=S.qs[S.q].a[p]||""; s.onchange=()=>{S.qs[S.q].a[p]=s.value||null; save(); draw();};
    d.innerHTML=`<div class='posTag'>${p}</div>`; d.appendChild(s);
    if(p=="GS"||p=="GA"){let b=document.createElement("button"); b.textContent="+1"; b.className="primary small"; b.onclick=()=>scorePos(p); d.appendChild(b);}
    pos.appendChild(d);
  });
  let st=document.getElementById("stats"); st.innerHTML="";
  S.players.forEach(pl=>{st.innerHTML+=`<div class='pill'><b>${pl.name}</b><span>${pl.g.reduce((a,b)=>a+b)} goals</span></div>`});
}
function init(){
  let p=document.getElementById("players"); p.innerHTML="";
  S.players.forEach(pl=>{
    let i=document.createElement("input"); i.value=pl.name; i.oninput=e=>{pl.name=e.target.value; save(); draw();};
    p.appendChild(i);
  });
  let q=document.getElementById("quarters"); q.innerHTML="";
  for(let i=0;i<4;i++){let b=document.createElement("button"); b.textContent="Q"+(i+1); b.className=i==S.q?"active":""; b.onclick=()=>{S.q=i; save(); draw();}; q.appendChild(b);}
  document.getElementById("teamName").value=S.team;
  document.getElementById("opponent").value=S.opp;
  document.getElementById("notes").value=S.notes;
  draw();
}
init();
</script>
</body>
</html>